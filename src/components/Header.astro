---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from './ThemeToggle.astro';
import NavigationDrawer from './NavigationDrawer.astro';
---

<header role="banner">
  <nav id="main-navigation" aria-label="Main navigation">
    <NavigationDrawer />
    
    <a href="/" class="logo-link">
      <svg
        height="40"
        preserveAspectRatio="xMinYMin meet"
        viewBox="0 0 219.28917 54.354222"
        role="img"
        aria-label="codea11y homepage"
        class="logo-svg"
      >
        <g transform="translate(-4.830636,-114.42924)">
          <g>
            <g>
              <path
                class="logo-blue"
                style="stroke-width:1.854;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1"
                d="m 32.129858,122.1698 -15.070225,0.0842 c -3.031204,0.0171 -5.877333,1.21638 -8.0141633,3.37718 -2.13683,2.1608 -3.304398,5.02022 -3.2876573,8.05159 0.035039,6.2668 5.1618916,11.33678 11.4287756,11.30199 l 15.070057,-0.0842 c 3.031287,-0.017 5.877668,-1.21639 8.014498,-3.37719 2.136831,-2.1608 3.304397,-5.02038 3.287489,-8.05159 -0.01698,-3.03128 -1.2163,-5.87758 -3.377101,-8.01441 -2.160718,-2.13691 -5.020217,-3.3044 -8.051673,-3.28757 z m -15.038534,5.73559 15.070139,-0.0843 c 3.150719,-0.0175 5.728314,2.53152 5.746056,5.68215 0.01724,3.1508 -2.531929,5.72857 -5.682312,5.74605 l -7.53507,0.0421 8.4e-5,7e-5 -7.535071,0.042 c -3.150718,0.0175 -5.728313,-2.53151 -5.745971,-5.68222 -0.01758,-3.1508 2.531425,-5.7284 5.682145,-5.74589 z"
              ></path>
              <path
                class="logo-red"
                style="stroke-width:1.854;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1"
                d="m 87.072129,121.95413 -15.070225,0.084 c -3.031286,0.017 -5.877498,1.21638 -8.014329,3.37718 -2.136831,2.1608 -3.30448,5.0203 -3.287571,8.0515 0.01691,3.03138 1.216215,5.87768 3.377016,8.01451 2.160885,2.13691 5.020386,3.30456 8.051757,3.28748 l 15.070057,-0.084 c 3.031287,-0.017 5.877669,-1.21622 8.0145,-3.37702 2.136832,-2.1608 3.304398,-5.02038 3.287405,-8.05168 -0.01698,-3.03129 -1.21622,-5.87766 -3.377019,-8.0145 -2.160801,-2.13682 -5.020132,-3.30431 -8.051591,-3.28749 z m 0.09527,17.07932 -7.53507,0.0421 -7.535069,0.0419 c -3.150723,0.0177 -5.728401,-2.53143 -5.745976,-5.68223 -0.0176,-3.15063 2.531427,-5.72823 5.682145,-5.74588 l 15.070143,-0.0841 c 3.150719,-0.0175 5.728312,2.53151 5.745972,5.68222 0.01764,3.15089 -2.531262,5.7284 -5.682145,5.7459 z"
              ></path>
              <g
                class="logo-orange"
                style="stroke-width:0.512326;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1"
                transform="matrix(3.6187955,0,0,3.6187955,30.416506,115.35624)"
              >
                <path
                  d="M 5.900404,10.015618 5.576408,13.103049 C 5.5186786,13.653166 5.026617,14.052252 4.4773577,13.994432 3.9280984,13.936613 3.5296348,13.443782 3.5873642,12.893665 L 4.3098044,6.009371 H 1 C 0.44771525,6.009371 0,5.5609565 0,5.0078091 0,4.4546618 0.44771525,4.0062473 1,4.0062473 h 10 c 0.552285,0 1,0.4484145 1,1.0015618 0,0.5531474 -0.447715,1.0015619 -1,1.0015619 H 7.6901956 l 0.7224402,6.884294 C 8.4703652,13.443782 8.0719016,13.936613 7.5226423,13.994432 6.973383,14.052252 6.4813214,13.653166 6.423592,13.103049 L 6.099596,10.015618 Z M 6,4.0062473 c -1.1045695,0 -2,-0.896829 -2,-2.0031236 C 4,0.89682901 4.8954305,0 6,0 7.1045695,0 8,0.89682901 8,2.0031237 8,3.1094183 7.1045695,4.0062473 6,4.0062473 Z"
                  style="stroke-width:0.512326;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1"
                ></path>
              </g>
            </g>
            <text
              xml:space="preserve"
              style="font-size:26.1897px;line-height:1.25;font-family:VT323;-inkscape-font-specification:VT323;letter-spacing:0px;stroke-width:0.30691"
              fill="currentColor"
              x="71.983971"
              y="163.30981"
            >
              <tspan
                style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:26.1897px;font-family:'Cal Sans';-inkscape-font-specification:'Cal Sans';stroke-width:0.30691"
                fill="currentColor"
                x="71.983971"
                y="163.30981">codea11y.dev</tspan
              >
            </text>
          </g>
        </g>
      </svg>
    </a>

    <div class="internal-links desktop-nav">
      <md-text-button href="/">Home</md-text-button>
      <md-text-button href="/blog">Blog</md-text-button>
      {import.meta.env.DEV && (
        <md-text-button href="/components">Style Guide</md-text-button>
      )}
      <md-text-button href="/about">About</md-text-button>
    </div>
    
    <div class="header-actions">
      <ThemeToggle />
    </div>
  </nav>
</header>
<style>
	header {
		position: relative; /* Start as relative */
		z-index: 100;
		width: 100%;
		margin: 0;
		padding: 0 1em;
		background: var(--md-sys-color-surface);
		border-bottom: 1px solid var(--md-sys-color-outline-variant);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		backdrop-filter: blur(8px);
		-webkit-backdrop-filter: blur(8px);
		display: block;
		box-sizing: border-box;
	}
	
	/* When sticky class is added by JavaScript */
	header.sticky {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
	}
	
	/* Compact sticky state */
	header.sticky {
		padding: 0 0.75em;
		box-shadow: 0 2px 8px rgba(var(--md-sys-color-shadow), 0.15);
	}
	
	/* Compact navigation when sticky */
	header.sticky nav {
		padding: 0.25em 0;
	}
	
	header.sticky nav a {
		padding: 0.5em 0.5em;
		font-size: 0.95em;
	}
	
	header.sticky .logo-link svg {
		height: 32px;
	}
	
	/* Logo color custom properties */
	:root {
		--logo-blue: #03047e;
		--logo-blue-dark: #4d4fff;
		--logo-red: #a70011;
		--logo-red-dark: #ff4d66;
		--logo-orange: #fd793f;
		--logo-orange-dark: #ff9966;
	}
	
	/* Logo styling for theme adaptation */
	.logo-svg {
		color: var(--md-sys-color-on-surface);
		transition: color 0.3s ease;
	}
	
	/* Make logo text inherit theme colors */
	.logo-svg text,
	.logo-svg tspan {
		fill: currentColor;
	}
	
	/* Logo shapes with theme-aware colors and WCAG AA contrast */
	.logo-svg path {
		transition: fill 0.3s ease, stroke 0.3s ease;
	}
	
	/* Blue shapes */
	.logo-svg .logo-blue {
		fill: var(--logo-blue);
		stroke: #000000;
		stroke-width: 1.854;
	}
	
	/* Red shapes */
	.logo-svg .logo-red {
		fill: var(--logo-red);
		stroke: #000000;
		stroke-width: 1.854;
	}
	
	/* Orange shapes */
	.logo-svg .logo-orange,
	.logo-svg .logo-orange path {
		fill: var(--logo-orange);
		stroke: #000000;
	}
	
	.logo-svg .logo-orange path {
		stroke-width: 0.512326;
	}
	
	/* Dark theme - match stroke to fill for visibility */
	:root[data-theme="dark"] .logo-svg .logo-blue {
		stroke: var(--logo-blue);
	}
	
	:root[data-theme="dark"] .logo-svg .logo-red {
		stroke: var(--logo-red);
	}
	
	:root[data-theme="dark"] .logo-svg .logo-orange,
	:root[data-theme="dark"] .logo-svg .logo-orange path {
		stroke: var(--logo-orange);
	}
	
	/* Dark theme overrides for WCAG AA compliance */
	:root[data-theme="dark"] {
		--logo-blue: #4d4fff;
		--logo-red: #ff4d66;
		--logo-orange: #ff9966;
	}
	
	/* Hover effect for the entire logo */
	.logo-link:hover .logo-svg {
		color: var(--md-sys-color-primary);
		transform: scale(1.02);
	}
	
	.logo-link {
		transition: transform 0.2s ease;
		display: inline-block;
	}
	
	h2 {
		margin: 0;
		font-size: 1em;
	}

	h2 a,
	h2 a.active {
		text-decoration: none;
	}
	nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
		min-height: 4rem;
		padding: 0.5rem 0;
	}
	nav a {
		padding: 1em 0.5em;
		color: var(--md-sys-color-on-surface);
		border-bottom: 4px solid transparent;
		text-decoration: none;
		transition: color 0.3s ease;
	}
	nav a.active {
		text-decoration: none;
		border-bottom-color: var(--md-sys-color-primary);
	}
	
	.header-actions {
		display: flex;
		align-items: center;
		gap: 1rem;
	}
	
	/* Material Design navigation buttons */
	md-text-button {
		--md-text-button-label-text-color: var(--md-sys-color-on-surface);
		--md-text-button-hover-label-text-color: var(--md-sys-color-primary);
		--md-text-button-pressed-label-text-color: var(--md-sys-color-primary);
		margin: 0 0.25rem;
		font-family: var(--font-family-logo);
		font-weight: 400;
		letter-spacing: 0.02em;
		font-size: 16pt;
		line-height: 1.4;
		padding: 0.75rem 1rem;
	}

	
	.internal-links {
		display: flex;
		gap: 0.5rem;
	}
	

	

	
	/* Small tablet - responsive navigation adjustments */
	@media (max-width: 720px) {
		.desktop-nav {
			display: none;
		}
		
		.header-actions {
			gap: 0.5rem;
		}
		
		nav {
			padding: 0.5em 0;
		}
		
		nav a {
			padding: 0.75em 0.25em;
			font-size: 0.9em;
		}
		
		md-text-button {
			margin: 0 0.125rem;
			font-size: 0.9em;
		}
	}
	
	/* Mobile responsiveness */
	@media (max-width: 600px) {
		header {
			padding: 0 0.5em;
		}
	}
	
	/* iPhone and small mobile devices */
	@media (max-width: 480px) {
		header {
			padding: 0 0.5em;
		}
		
		nav {
			flex-wrap: nowrap;
			gap: 0.5rem;
		}
		
		.logo-link {
			flex: 1;
			text-align: left;
			padding: 0.5em 0 !important;
		}
		
		.logo-link svg {
			height: 32px;
		}
		
		.header-actions {
			gap: 0.5rem;
		}
	}
	
	/* Extra small devices */
	@media (max-width: 375px) {
		.logo-link svg {
			height: 28px;
		}
		
		.header-actions {
			gap: 0.25rem;
		}
	}
</style>

<script>
	// Handle sticky header state with fixed positioning
	function handleStickyHeader() {
		const header = document.querySelector('header');
		if (!header) {
			
			return;
		}
		let scrolled = false;
		const headerHeight = header.offsetHeight;
		function updateStickyState() {
			if (!header) return;
			
			const currentlyScrolled = window.scrollY > 50;
			
			if (currentlyScrolled !== scrolled) {
				scrolled = currentlyScrolled;
				
				if (scrolled) {
					header.classList.add('sticky');
					// Add padding to body to prevent content jump
					document.body.style.paddingTop = headerHeight + 'px';
				} else {
					header.classList.remove('sticky');
					// Remove padding when not sticky
					document.body.style.paddingTop = '0';
				}
			}
		}
		
		// Throttled scroll handler for better performance
		let ticking = false;
		function onScroll() {
			if (!ticking) {
				requestAnimationFrame(() => {
					updateStickyState();
					ticking = false;
				});
				ticking = true;
			}
		}
		
		// Check initial state
		updateStickyState();
		
		// Listen for scroll events
		window.addEventListener('scroll', onScroll, { passive: true });
		
		// Cleanup function for when the component is removed
		return () => {
			window.removeEventListener('scroll', onScroll);
		};
	}
	
	// Initialize when DOM is ready
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', handleStickyHeader);
	} else {
		handleStickyHeader();
	}
</script>
